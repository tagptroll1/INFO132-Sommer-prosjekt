const fetch = process.browser ? window.fetch : require("node-fetch").default;

export async function getResponses(ids) {
    try {
        const resp = await fetch("/api/feedback", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(ids),
        });
        return await resp.json();
    } catch (err) {
        console.error(err);
        return [];
    }
}

export async function postData(data) {
    try {
        fetch("/api/data", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
        });
    } catch (err) {
        console.log(`Data post failed ${err}`);
    }
}

export async function postAndGetResponse(idAndAnswer) {
    const ids = Object.keys(idAndAnswer);
    const answers = Object.values(idAndAnswer);

    await postData(answers);
    return await getResponses(ids);
}
